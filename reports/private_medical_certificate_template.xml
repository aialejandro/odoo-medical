<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Private Medical Certificate Template - Version Corregida -->
    <template id="report_private_medical_certificate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="consultation">
                <div class="header" style="text-align: center; border-bottom: 1px solid #ccc; margin-bottom: 20px;">
                    <h2 style="color: #2E86AB;">CERTIFICADO MÉDICO PRIVADO</h2>
                </div>
                <div class="page" style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5;">
                    <div class="oe_structure"/>
                    
                    <!-- Doctor Information -->
                    <div style="margin-bottom: 30px;">
                        <p><strong>Doctor:</strong> 
                            <t t-if="consultation.doctor_id">
                                <span t-esc="consultation.doctor_id.name"/>
                            </t>
                            <t t-else="">No asignado</t>
                        </p>
                        <p t-if="consultation.doctor_license"><strong>Licencia Médica:</strong> <span t-esc="consultation.doctor_license"/></p>
                        <p><strong>Fecha:</strong> <span t-esc="consultation.consultation_date.strftime('%d/%m/%Y') if consultation.consultation_date else 'No especificada'"/></p>
                    </div>

                    <!-- Certificate Content -->
                    <div style="text-align: justify; margin: 40px 0;">
                        <p>Por medio del presente, <strong>CERTIFICO</strong> que el/la paciente:</p>
                        
                        <div style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #2E86AB;">
                            <p><strong>Nombre:</strong> 
                                <t t-if="consultation.patient_id">
                                    <span t-esc="consultation.patient_id.name"/>
                                </t>
                                <t t-else="">No especificado</t>
                            </p>
                            <p t-if="consultation.patient_vat"><strong>Cédula/RUC:</strong> <span t-esc="consultation.patient_vat"/></p>
                            <p t-if="consultation.age and consultation.age > 0"><strong>Edad:</strong> <span t-esc="consultation.age"/> años</p>
                            <p t-if="consultation.birth_date"><strong>Fecha de Nacimiento:</strong> <span t-esc="consultation.birth_date.strftime('%d/%m/%Y')"/></p>
                        </div>

                        <!-- Medical Information -->
                        <p t-if="consultation.diagnosis">
                            <strong>Diagnóstico:</strong> <span t-esc="consultation.diagnosis"/>
                        </p>

                        <p t-if="consultation.cie10_code">
                            <strong>Código CIE-10:</strong> 
                            <t t-if="consultation.cie10_code.code"><span t-esc="consultation.cie10_code.code"/></t>
                        </p>

                        <p t-if="consultation.has_symptoms">
                            El/la paciente <strong>presenta síntomas</strong> relacionados con la condición médica diagnosticada.
                        </p>

                        <p t-if="consultation.has_symptoms == False">
                            El/la paciente <strong>no presenta síntomas</strong> al momento de la consulta.
                        </p>

                        <!-- Treatment Information -->
                        <p t-if="consultation.treatment_description">
                            <strong>Tratamiento Prescrito:</strong><br/>
                            <span t-esc="consultation.treatment_description"/>
                        </p>

                        <!-- Work Restrictions -->
                        <t t-if="consultation.work_restriction_type and consultation.work_restriction_type != 'none'">
                            <p><strong>Restricciones Laborales:</strong></p>
                            <p t-if="consultation.work_restriction_type == 'isolation'">
                                Se recomienda <strong>aislamiento</strong> por motivos médicos.
                            </p>
                            <p t-if="consultation.work_restriction_type == 'absolute_rest'">
                                Se prescribe <strong>reposo absoluto</strong> por razones médicas.
                            </p>
                            <p t-if="consultation.work_restriction_type == 'telework'">
                                Se recomienda <strong>teletrabajo</strong> como medida preventiva.
                            </p>
                        </t>

                        <!-- Rest Period -->
                        <t t-if="consultation.rest_days and consultation.rest_days > 0">
                            <p>
                                <strong>Período de Reposo:</strong> <span t-esc="consultation.rest_days"/> días
                                <t t-if="consultation.rest_start_date and consultation.rest_end_date">
                                    (desde el <span t-esc="consultation.rest_start_date.strftime('%d/%m/%Y')"/> 
                                    hasta el <span t-esc="consultation.rest_end_date.strftime('%d/%m/%Y')"/>)
                                </t>
                            </p>
                        </t>

                        <!-- Medical Cause -->
                        <p t-if="consultation.medical_cause">
                            <strong>Causa Médica:</strong> 
                            <t t-if="consultation.medical_cause == 'general_illness'">Enfermedad General</t>
                            <t t-elif="consultation.medical_cause == 'work_accident'">Accidente Laboral</t>
                            <t t-elif="consultation.medical_cause == 'traffic_accident'">Accidente de Tránsito</t>
                            <t t-elif="consultation.medical_cause == 'maternity'">Maternidad</t>
                            <t t-elif="consultation.medical_cause == 'catastrophic_illness'">Enfermedad Catastrófica</t>
                        </p>

                        <!-- Prescription -->
                        <t t-if="consultation.prescription_line_ids">
                            <h4 style="margin-top: 30px; color: #2E86AB;">Prescripción Médica:</h4>
                            <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                                <thead>
                                    <tr style="background-color: #f8f9fa;">
                                        <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Medicamento</th>
                                        <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Forma</th>
                                        <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Concentración</th>
                                        <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Cantidad</th>
                                        <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Posología</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="consultation.prescription_line_ids" t-as="prescription">
                                        <tr>
                                            <td style="border: 1px solid #dee2e6; padding: 8px;"><span t-esc="prescription.medication_name or ''"/></td>
                                            <td style="border: 1px solid #dee2e6; padding: 8px;"><span t-esc="prescription.pharmaceutical_form or ''"/></td>
                                            <td style="border: 1px solid #dee2e6; padding: 8px;">
                                                <span t-esc="prescription.concentration or ''"/>
                                                <span t-if="prescription.concentration_unit"> <span t-esc="prescription.concentration_unit"/></span>
                                            </td>
                                            <td style="border: 1px solid #dee2e6; padding: 8px;"><span t-esc="prescription.quantity_to_dispense or ''"/></td>
                                            <td style="border: 1px solid #dee2e6; padding: 8px;"><span t-esc="prescription.posology or ''"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>

                        <!-- Observations -->
                        <p t-if="consultation.observations">
                            <strong>Observaciones:</strong><br/>
                            <span t-esc="consultation.observations"/>
                        </p>

                        <!-- Next Appointment -->
                        <p t-if="consultation.next_appointment_date">
                            <strong>Próxima Cita:</strong> <span t-esc="consultation.next_appointment_date.strftime('%d/%m/%Y')"/>
                        </p>
                    </div>

                    <!-- Signature Section -->
                    <div style="margin-top: 80px; text-align: center;">
                        <div style="border-top: 1px solid #000; width: 300px; margin: 0 auto;">
                            <p style="margin-top: 10px; font-weight: bold;">
                                <t t-if="consultation.doctor_id">
                                    <span t-esc="consultation.doctor_id.name"/><br/>
                                </t>
                                <t t-else="">Doctor no asignado<br/></t>
                                <span t-if="consultation.doctor_license">Lic. Médica: <span t-esc="consultation.doctor_license"/></span>
                            </p>
                        </div>
                    </div>

                    <div class="oe_structure"/>
                </div>
            </t>
        </t>
    </template>

</odoo>
